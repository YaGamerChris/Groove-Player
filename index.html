<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reproductor MiChris</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#00ffff">
  <link rel="icon" href="https://cdn6.aptoide.com/imgs/0/1/2/01278c8b815f6ac46db40dd3829eba0a_icon.png" type="image/x-icon">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
<style>
:root {
  --bg-color: #111;
  --text-color: #fff;
  --accent-color: #fff;
  --bg-secondary: #222;
}
body {
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,var(--bg-color),var(--bg-secondary));
  color:var(--text-color);
  height:100vh;
  display:flex;
  overflow:hidden;
  transition:background 1.5s ease,color 0.5s ease;
}
body.has-cover::before{
  content:"";
  position:fixed;
  inset:0;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  opacity:0.3;
  filter:blur(30px);
  z-index:-1;
  pointer-events:none;
  transition:background-image 1.5s ease-in-out;
}
.main {
  flex: 1;
  display: flex;
  flex-direction: row;
  justify-content: center;  /* reproductor centrado horizontalmente */
  align-items: center;      /* <-- centrado verticalmente */
  padding: 20px;
  gap: 20px;
}
.now-playing{
  display:flex;
  flex-direction:column;
  align-items:center;
  width:350px;
}
.cover{
  width:280px;
  height:280px;
  background:#444;
  border-radius:15px;
  background-size:cover;
  background-position:center;
  margin-bottom:20px;
  box-shadow:0 0 25px var(--accent-color);
  transition: all 0.5s ease;
}
.cover.playing{animation: zoomInOut 3s ease infinite;}
@keyframes zoomInOut{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
.track-title{font-size:26px;font-weight:bold;margin-bottom:5px;text-align:center;text-shadow:0 0 10px var(--accent-color);}
.track-artist{font-size:16px;color:#aaa;margin-bottom:15px;text-align:center;text-shadow:0 0 6px var(--accent-color);}
.controls{
  display:flex;
  justify-content:center;
  gap:15px; /* <- espacio entre botones */
  flex-wrap:wrap;
  margin-bottom:15px;
}
.controls button{
  font-size:26px;
  background:linear-gradient(145deg,#333,#111);
  border:none;
  border-radius:12px;
  color:var(--text-color);
  cursor:pointer;
  padding:12px 18px;
  box-shadow:4px 4px 8px rgba(0,0,0,0.5),-4px -4px 8px rgba(255,255,255,0.05);
  transition:all 0.3s ease;
}
.controls button:hover{
  background:linear-gradient(145deg,#555,#222);
  color:var(--accent-color);
  transform:scale(1.1);
}
.controls button:active{
  transform:scale(0.95);
  box-shadow:inset 2px 2px 6px rgba(0,0,0,0.5), inset -2px -2px 6px rgba(255,255,255,0.05);
}
.special-btn{
  font-size:16px;
  background:linear-gradient(145deg,#222,#000);
  border:none;
  border-radius:12px;
  padding:12px 20px;
  color:#00ffff;
  cursor:pointer;
  box-shadow:4px 4px 8px rgba(0,0,0,0.5),-4px -4px 8px rgba(0,255,255,0.2);
  transition:all 0.3s ease;
}
.special-btn:hover{
  background:linear-gradient(145deg,#00ffff,#003333);
  transform:scale(1.05);
  color:#fff;
  box-shadow:2px 2px 8px rgba(0,0,0,0.6),-2px -2px 8px rgba(0,255,255,0.3);
}
.special-btn:active{
  transform:scale(0.95);
}
.folder-buttons{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:10px;
  align-items:center;
}
#playlistContainer{
  position:absolute;
  right:20px;
  top:20px;
  bottom:20px;
  width:320px;
  background:var(--bg-secondary);
  border-radius:12px;
  padding:10px;
  overflow-y:auto;
}
.playlist-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:6px 4px;
  border-radius:8px;
  transition:0.3s;
  cursor:pointer;
}
.playlist-item:hover{background:rgba(0,255,255,0.2);}
.playlist-item.active{background:rgba(0,255,255,0.4);}
.playlist-item img{width:40px;height:40px;border-radius:6px;object-fit:cover;}
.playlist-item .text{display:flex;flex-direction:column;font-size:14px;overflow:hidden;}
.playlist-item .text .song-title{font-weight:bold;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.playlist-item .text .song-artist{color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
@media (max-width:1000px){
  #playlistContainer{
    display:none;
  }
}
</style>
</head>
<body>
  <div class="main">
    <div class="now-playing" id="nowPlaying">
      <div class="cover" id="cover"></div>
      <div class="track-title" id="title">Sin canci√≥n</div>
      <div class="track-artist" id="artist">Unknown</div>
      <div class="controls">
        <button id="prev" title="Anterior">‚èÆÔ∏è</button>
        <button id="play" title="Reproducir/Pausar">‚ñ∂Ô∏è</button>
        <button id="next" title="Siguiente">‚è≠Ô∏è</button>
        <button id="repeat" title="Repetir">OFF</button>
      </div>
      <div class="folder-buttons">
        <button id="selectFolderBtn" class="special-btn">üìÇ Seleccionar Carpeta</button>
        <input type="file" id="folderInput" webkitdirectory multiple style="display:none;">
        <button id="installBtn" class="special-btn" style="display:none;">‚ûï Instalar App</button>
      </div>
    </div>
    <div id="playlistContainer">
      <div style="text-align:center; color:#aaa;">No hay canciones seleccionadas</div>
    </div>
    <audio id="player"></audio>
  </div>
<script>
const player=document.getElementById('player');
const cover=document.getElementById('cover');
const title=document.getElementById('title');
const artist=document.getElementById('artist');
const playBtn=document.getElementById('play');
const nextBtn=document.getElementById('next');
const prevBtn=document.getElementById('prev');
const repeatBtn=document.getElementById('repeat');
const folderInput=document.getElementById('folderInput');
const selectFolderBtn=document.getElementById('selectFolderBtn');
const playlistContainer=document.getElementById('playlistContainer');

let playlist=[];
let currentIndex=0;
let isPlaying=false;
let repeatMode='off';

function playTrack(){
  player.play();
  isPlaying=true;
  playBtn.textContent='‚è∏Ô∏è';
  cover.classList.add('playing');
  updatePlaylistUI();
}
function pauseTrack(){
  player.pause();
  isPlaying=false;
  playBtn.textContent='‚ñ∂Ô∏è';
  cover.classList.remove('playing');
  updatePlaylistUI();
}

function loadTrack(index){
  const file=playlist[index];
  const url=URL.createObjectURL(file.file);
  player.src=url;
  title.textContent=file.title;
  artist.textContent=file.artist;
  cover.style.backgroundImage=file.cover?`url(${file.cover})`:'url("https://via.placeholder.com/280x280?text=Sin+Portada")';
  cover.classList.remove('playing');

  // üü¶ ACTUALIZAR MEDIA SESSION
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: file.title,
      artist: file.artist,
      album: "Reproductor MiChris",
      artwork: [
        { src: file.cover || "https://via.placeholder.com/512?text=Sin+Portada", sizes: '512x512', type: 'image/jpeg' }
      ]
    });

    // Controles del mini reproductor
    navigator.mediaSession.setActionHandler('play', () => playTrack());
    navigator.mediaSession.setActionHandler('pause', () => pauseTrack());
    navigator.mediaSession.setActionHandler('previoustrack', () => {
      if (currentIndex > 0) {
        currentIndex--;
        loadTrack(currentIndex);
        playTrack();
      }
    });
    navigator.mediaSession.setActionHandler('nexttrack', () => {
      if (currentIndex + 1 < playlist.length) {
        currentIndex++;
        loadTrack(currentIndex);
        playTrack();
      }
    });
  }
}

playBtn.addEventListener('click',()=>{ isPlaying?pauseTrack():playTrack(); });
nextBtn.addEventListener('click',()=>{ if(currentIndex+1<playlist.length){ currentIndex++; loadTrack(currentIndex); playTrack(); } });
prevBtn.addEventListener('click',()=>{ if(currentIndex>0){ currentIndex--; loadTrack(currentIndex); playTrack(); } });

repeatBtn.addEventListener('click',()=>{
  if(repeatMode==='off'){ repeatMode='all'; repeatBtn.textContent='üîÅ'; repeatBtn.style.color='#00ffff'; }
  else if(repeatMode==='all'){ repeatMode='one'; repeatBtn.textContent='üîÇ'; repeatBtn.style.color='#00ffff'; }
  else{ repeatMode='off'; repeatBtn.textContent='OFF'; repeatBtn.style.color='#fff'; }
});

player.addEventListener('ended',()=>{
  switch(repeatMode){
    case 'one': player.currentTime=0; playTrack(); break;
    case 'all': currentIndex=(currentIndex+1)%playlist.length; loadTrack(currentIndex); playTrack(); break;
    case 'off':
      if(currentIndex+1<playlist.length){ currentIndex++; loadTrack(currentIndex); playTrack(); }
      else pauseTrack();
    break;
  }
});

// Seleccionar carpeta
selectFolderBtn.addEventListener('click',()=>{ folderInput.click(); });
folderInput.addEventListener('change',()=>{
  playlist=Array.from(folderInput.files)
    .filter(f=>f.type.startsWith('audio/'))
    .map(f=>({file:f,title:f.name,artist:"Desconocido",cover:'https://via.placeholder.com/40x40?text=?'}));
  playlist.sort((a,b)=>a.title.localeCompare(b.title));
  if(playlist.length){ currentIndex=0; loadTrack(0); playTrack(); }
  updatePlaylistUI();
});

// Actualizar lista
function updatePlaylistUI(){
  playlistContainer.innerHTML='';
  if(!playlist.length){
    playlistContainer.innerHTML='<div style="text-align:center; color:#aaa;">No hay canciones seleccionadas</div>';
    return;
  }
  playlist.forEach((song,i)=>{
    const div=document.createElement('div');
    div.className='playlist-item'+(i===currentIndex?' active':'');
    const img=document.createElement('img'); img.src=song.cover;
    const text=document.createElement('div'); text.className='text';
    const t=document.createElement('div'); t.className='song-title'; t.textContent=song.title;
    const a=document.createElement('div'); a.className='song-artist'; a.textContent=song.artist;
    text.appendChild(t); text.appendChild(a);
    div.appendChild(img); div.appendChild(text);
    div.addEventListener('click',()=>{ currentIndex=i; loadTrack(i); playTrack(); });
    playlistContainer.appendChild(div);
  });
}

// Leer metadatos y portada
folderInput.addEventListener('change',()=>{
  playlist.forEach((song,index)=>{
    jsmediatags.read(song.file,{
      onSuccess:function(tag){
        if(tag.tags.title) song.title=tag.tags.title;
        if(tag.tags.artist) song.artist=tag.tags.artist;
        if(tag.tags.picture){
          let base64=""; 
          for(let i=0;i<tag.tags.picture.data.length;i++) base64+=String.fromCharCode(tag.tags.picture.data[i]);
          song.cover=`data:${tag.tags.picture.format};base64,${btoa(base64)}`;
          if(index===currentIndex) cover.style.backgroundImage=`url(${song.cover})`;
        }
        updatePlaylistUI();
      }
    });
  });
});

repeatBtn.textContent='OFF'; repeatBtn.style.color='#fff';
    </script>
</body>
</html>
